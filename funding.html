
<!DOCTYPE html>
<html>
<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.15.0/lodash.js"></script>
  <script src="ripple-0.22.0-min.js"></script>
  <script>
    console.log(ripple);
 //  var api = new ripple.RippleAPI({server:'wss://s1.ripple.com/'});
  var api = new ripple.RippleAPI({server:'wss://s.altnet.rippletest.net:51233'});


api.on('error', (errorCode, errorMessage) => {
  console.log(errorCode + ': ' + errorMessage);
});

api.on('connected', () => {
  console.log('connected');
});

api.on('disconnected', (code) => {
  // console.log('disconnected, code:', code);
  return;
});

const addresses = {

    "issuer" : {
        "name" : "Issuer",
        "address" : "rQp8Q9S5quQgYPbBZ4AWeoKsyUSa9GHgVA",
        "secret"  : "shVKQzF5fzEVpMZ983cPerCoFMvNB"
    },

    "marketmaker" : {
        "name" : "Market Maker",
        "address" : "rE4tHWzbhetiDqswsnnUPbwdpZxwGGr9P8",
        "secret"  : "shkQmhfq9tQvrCHdkp89WqEgpPdVH"
    },

    "alice" : { 
        "name" : "Alice",
        "address" : "rMVqbZvogvTvvH8hWw2NriPdzawkngWT9T",
        "secret"  : "spmKBXSc7ttBQwkK573bhoj2RNhhL"
    }, 

    "bob" : { 
        "name" : "Bob",
        "address" : "rMKqQMdXnB7dJwTcniYYvAvGw2z1PRF5kH",
        "secret"  : "ssiwE2dYDucMpm4PMmFxjsEyfLmCu"
    }
}

api.connect().then(() => {

  /* begin custom code ------------------------------------ */
  // Alice

  let payment = {
    "source": {
      "address": addresses.issuer.address,
      "maxAmount": {
        "value": "100",
        "currency": "BRL",
        "counterparty": addresses.issuer.address
      }
    },
    "destination": {
      "address": addresses.alice.address,
      "amount": {
        "value":"100",
        "currency": "BRL",
        "counterparty": addresses.issuer.address
      }
    }

    "memos": [
        {
          "type": "test",
          "format": "plain/text",
          "data": " But much earlier, the night before Luke had gone to London for six months, before the band was named and when Gabe and Eric had been playing solo shows together, sharing a set, backing each other up; back before all this Luke came to Boston to talk about what theyâ€™d accomplish over the next few months, how to deal with Gabe, that he needed guidance and most of all an editor, someone to tell him when an idea didnâ€™t work, to point out the line between good stupid and bad stupid. This meeting was conducted at the first bar, outside on the patio, smoking and drinking, nearly-naked college kids celebrating around them, and they slouched at a table right in the middle of the floor, speaking slowly and with long pauses. Business concluded, they made their way to the second bar, where Eric instigated an arm-wrestling competition with a hipster in a drum major shirt, a Boston hipster, a sorry imitation of the New York standard. They were drinking Mojo, a microbrew from Colorado famous for inducing blackouts and raising bad blood. Eric was smoking outside and just started talking to the hipster, asking him where he got his hair cut, really pestering him about it which okay was pretty obnoxious, suggesting salons and even specific stylists by name, the guy denying that he got his hair cut anywhere, like it just stays that length all the time, even the deliberately shaggy parts over his ears. But then Eric got distracted by this other guy, a friendly guy with a shaved head and a thick neck who was talking about the difference between a punch you see coming and a punch you donâ€™t, how when youâ€™re going to take a punch you shouldnâ€™t tense your muscles, just let the blow bounce off you, your muscle and in Ericâ€™s case fat absorbing the shock of the blow. Eric asked him to demonstrate, and the guy said no way am I going to hit you man, and Eric, with the love of the world, told him well obviously donâ€™t really hit me, Iâ€™m a pussy thatâ€™s only ever been in one real fight. Pull the punch, Eric said, but hit me once in one arm and Iâ€™ll tense it up, hit me in the other and Iâ€™ll keep loose. So the guy hit him in the loose arm and yeah that really wasnâ€™t that bad at all, then in the tense arm and Eric rubbed his arm and said yeah you were absolutely right man that hurts. Then he went back in the bar and was waiting for a drink, Luke talking to Sasha, the Montenegrin expatriate, Sasha saying that the reason he gets so many girls is because he knows which shoes to buy, denies up and down that it has anything to do with his accent because that would be an insult to his inborn ability to choose the right shoes and get girls. Eric got his drink and turned, taking a sip and wiping the bottom of the glass with a cocktail napkin, and there was hipster drum major guy again, with the bad attitude and the hair, puffing his chest which looked all the more ridiculous because of the brass buttons and epaulets on his shirt, and now the guyâ€™s hackles were raised, like you could see him just standing there and bristling, and he asked Eric if he wanted to fight, and Eric said no but I would like to arm-wrestle. Eric has done this before, has challenged people to an arm-wrestling contest in bars, because it is a way of resolving conflict peacefully, because he will probably lose, but graciously, leaving his opponents zero options in terms of impressing people and getting girls. But he also wanted to win if he could, and heâ€™d developed a strategy: do not try to force the opponent to the table, but merely hold him, wearing him down, relaxing the white muscle fibers that provide quick action, waiting until the guy is tired and then finishing him in one stroke. He did this with the hipster but let his arm drop to forty-five degrees and held the guy there, let the hipster think heâ€™s winning, started making bored faces, yawning. The hipster was angry, wanted a rematch, so they went again, and this time Eric let his arm fall to ten degrees and just held it there, thirty-five degrees more insulting, and suddenly the hipster stood up and announced heâ€™d won, which Eric at this point was drunk and belligerent enough to contest. When he stood up to tell the guy that he hadnâ€™t won, to explain it all to everyone, he saw that the place was suddenly full of arm-wrestlers, people paired up and facing off across the narrow tables, guys with beers and one hand in their pockets, smiling, cheering, making jokes about placing bets. They left the bar, Luke and Eric, heading back to the apartment where Linda was probably asleep which meant they could smoke indoors. They got in a cab, Eric swaying across the seat as they turned corners, now extremely drunk, memory-loss drunk, almost never happens. He managed to tell the cabbie where to go and when they pulled up to the apartment he apparently paid the man, I mean the money disappeared, and then he got out of the car but he stumbled a little getting out, dropped some money on the ground, and when he picked up the money it was covered in blood. He looked at his hand, still standing in the middle of Cambridge Street, and the pinky finger on his guitar hand was bleeding, brown stains on his jeans. He couldnâ€™t move the finger. How the fuck did that happen he thought as he followed Luke inside, Luke taking care of everything all of a sudden. (Alison was in Providence, waiting for her boyfriend to get home from his classes at Johnson-Wales, one of the premiere culinary academies in the nation, drinking a Miller High-Life and listening to music, increasingly annoyed.) They went in the back door and Eric leaned against the white frame, leaving a streak of blood, Linda suddenly awake in a bathrobe and asking them both what happened, but they were both far too drunk to explain anything, and in any case neither of them actually knew what had happened. Linda cleaned the wound while Eric stood at the kitchen sink, trying not to pass out. She wrapped the finger in gauze. The next day Eric woke up early even though he didnâ€™t have to work, re-wrapped his hand and Gabe arrived, ready to play, and they got their outfits and got ready and played a show, Eric on the guitar with three fingers, white bandages hanging from his wrist. "
        }
      ]


  };

  return api.preparePayment(addresses.issuer.address, payment).catch((error) => {
    
    console.log("Error:", error)
    return;

  })

}).then((preparedPayment) => {
    
  // console.log(preparedPayment);

  return api.sign(preparedPayment.txJSON, addresses.issuer.secret)

}).then((signedPayment) => {

  // console.log(signedPayment)
  console.log("TX Id:", signedPayment.id)
  
  return api.submit(signedPayment.signedTransaction).catch((error) => {
    
    console.log("Error:", error)
    return;

  })

}).then((submittedPayment) => {

  // console.log(submittedPayment);

  if(submittedPayment.resultCode === "tesSUCCESS") {
    // https://ripple.com/build/transactions/#full-transaction-response-list

    console.log("Yay! Alice's address was funded successfully!")
  
  } else {

    console.log("Something went wrong!", submittedPayment)
    return;

  }


  /* end custom code -------------------------------------- */

}).then(() => {

  /* begin custom code ------------------------------------ */
  // Bob

  let payment = {
    "source": {
      "address": addresses.issuer.address,
      "maxAmount": {
        "value": "100",
        "currency": "USD",
        "counterparty": addresses.issuer.address
      }
    },
    "destination": {
      "address": addresses.bob.address,
      "amount": {
        "value":"100",
        "currency": "USD",
        "counterparty": addresses.issuer.address
      }
    }
  };

  return api.preparePayment(addresses.issuer.address, payment).catch((error) => {
    
    console.log("Error:", error)
    return;

  })

}).then((preparedPayment) => {
    
  // console.log(preparedPayment);

  return api.sign(preparedPayment.txJSON, addresses.issuer.secret)

}).then((signedPayment) => {

  // console.log(signedPayment)
  console.log("TX Id:", signedPayment.id)
  
  return api.submit(signedPayment.signedTransaction).catch((error) => {
    
    console.log("Error:", error)
    return;

  })

}).then((submittedPayment) => {

  // console.log(submittedPayment);

  if(submittedPayment.resultCode === "tesSUCCESS") {
    // https://ripple.com/build/transactions/#full-transaction-response-list

    console.log("Yay! Bob's address was funded successfully!")
  
  } else {

    console.log("Something went wrong!", submittedPayment)
    return;

  }


  /* end custom code -------------------------------------- */

}).then(() => {

  /* begin custom code ------------------------------------ */
  // Market Maker

  let payment = {
    "source": {
      "address": addresses.issuer.address,
      "maxAmount": {
        "value": "10000",
        "currency": "BRL",
        "counterparty": addresses.issuer.address
      }
    },
    "destination": {
      "address": addresses.marketmaker.address,
      "amount": {
        "value":"10000",
        "currency": "BRL",
        "counterparty": addresses.issuer.address
      }
    }
  };

  return api.preparePayment(addresses.issuer.address, payment).catch((error) => {
    
    console.log("Error:", error)
    return;

  })

}).then((preparedPayment) => {
    
  // console.log(preparedPayment);

  return api.sign(preparedPayment.txJSON, addresses.issuer.secret)

}).then((signedPayment) => {

  // console.log(signedPayment)
  console.log("TX Id:", signedPayment.id)
  
  return api.submit(signedPayment.signedTransaction).catch((error) => {
    
    console.log("Error:", error)
    return;

  })

}).then((submittedPayment) => {

  // console.log(submittedPayment);

  if(submittedPayment.resultCode === "tesSUCCESS") {
    // https://ripple.com/build/transactions/#full-transaction-response-list

    console.log("Yay! Market Maker's address was funded successfully!")
  
  } else {

    console.log("Something went wrong!", submittedPayment)
    return;

  }


  /* end custom code -------------------------------------- */

}).then(() => {

  /* begin custom code ------------------------------------ */
  // Market Maker

  let payment = {
    "source": {
      "address": addresses.issuer.address,
      "maxAmount": {
        "value": "10000",
        "currency": "USD",
        "counterparty": addresses.issuer.address
      }
    },
    "destination": {
      "address": addresses.marketmaker.address,
      "amount": {
        "value":"10000",
        "currency": "USD",
        "counterparty": addresses.issuer.address
      }
    }
  };

  return api.preparePayment(addresses.issuer.address, payment).catch((error) => {
    
    console.log("Error:", error)
    return;

  })

}).then((preparedPayment) => {
    
  // console.log(preparedPayment);

  return api.sign(preparedPayment.txJSON, addresses.issuer.secret)

}).then((signedPayment) => {

  // console.log(signedPayment)
  console.log("TX Id:", signedPayment.id)
  
  return api.submit(signedPayment.signedTransaction).catch((error) => {
    
    console.log("Error:", error)
    return;

  })

}).then((submittedPayment) => {

  // console.log(submittedPayment);

  if(submittedPayment.resultCode === "tesSUCCESS") {
    // https://ripple.com/build/transactions/#full-transaction-response-list

    console.log("Yay! Market Maker's address was funded successfully!")
  
  } else {

    console.log("Something went wrong!", submittedPayment)
    return;

  }


  /* end custom code -------------------------------------- */

}).then(() => {

  return api.disconnect()

}).catch(console.error)
  </script>

  <style type="text/css">
    td, th { border: 1px solid black; padding: 5px; }
    table { border-collapse: collapse; }
  </style>



</head>
<body></body>
</html>
